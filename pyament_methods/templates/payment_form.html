{% extends 'base.html' %}

{% block title %}Pagamento{% endblock %}

{% block content %}
<div class="container mt-4">
    <h3 class="display-6 text-white">Selecione um Método de Pagamento</h3>
    <div class="card" style="background: linear-gradient(135deg, rgb(60, 60, 70) 100%, rgb(60, 50, 40) 80%); border-radius: 15px; color: white;">
        <div class="card-body">
            <form id="payment-form" class="form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="amount" class="text-white">Valor:</label>
                    <input type="number" class="form-control" id="amount" name="amount" required>
                </div>
                <button type="button" class="btn btn-primary" id="boleto-button">Pagar com Boleto</button>
                <button type="button" class="btn btn-primary" id="pix-button">Pagar com Pix</button>
                <button type="button" class="btn btn-primary" id="card-button">Pagar com Cartão</button>
                <button type="button" class="btn btn-primary" id="cash-button">Pagar com Dinheiro</button>
            </form>
        </div>
    </div>
    
    <a href="{% url 'home' %}" class="btn btn-secondary mt-3" style="border-radius: 10px;">Cancelar e Voltar</a>
</div>

<style>
    /* Estilos adicionais para manter a identidade visual */
    h3.display-6 {
        color: white; /* Cor do título */
    }

    .btn-primary {
        background-color: #007bff; /* Cor primária do botão */
        border-color: #007bff; /* Borda do botão */
    }

    .btn-secondary {
        background-color: #6c757d; /* Cor do botão cancelar */
        border-color: #6c757d; /* Borda do botão cancelar */
    }

    .btn-secondary:hover {
        background-color: #5a6268; /* Cor do botão cancelar ao passar o mouse */
        border-color: #545b62; /* Borda do botão cancelar ao passar o mouse */
    }

    .btn-primary:hover {
        background-color: #0056b3; /* Cor do botão salvar ao passar o mouse */
        border-color: #004085; /* Borda do botão salvar ao passar o mouse */
    }

    /* Ajustes gerais de botão */
    .btn {
        border-radius: 10px; /* Bordas arredondadas para todos os botões */
    }
</style>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe('pk_test_51Q84WcGCcu8ObJFYbp2Lt41T9JMnaIrBN5UFIzmKFQTYs2Rbu7xOg8YPEThjFJFfk0uRbYIPGdHwcpipjST712uE00tQlHhpvy'); // Substitua pela sua chave pública

    document.getElementById('boleto-button').addEventListener('click', function() {
        handlePayment('boleto');
    });

    document.getElementById('pix-button').addEventListener('click', function() {
        handlePayment('pix');
    });

    document.getElementById('card-button').addEventListener('click', function() {
        handlePayment('card');
    });

    document.getElementById('cash-button').addEventListener('click', function() {
        handlePayment('cash');
    });

    function handlePayment(method) {
        const amount = document.getElementById('amount').value;
        const url = `/payment/${method}/`; // Adicionando a barra ao final da URL

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'), // Certifique-se de ter uma função para obter o cookie CSRF
            },
            
            body: JSON.stringify({ amount: amount }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                console.log('Pagamento processado com sucesso!');
                // Aqui você pode redirecionar ou mostrar uma mensagem de sucesso
            } else {
                console.error(data.error);
                // Aqui você pode mostrar uma mensagem de erro
            }
        })
        .catch(error => {
            console.error('Houve um problema com a requisição:', error);
            // Aqui você pode mostrar uma mensagem de erro ao usuário
        });
    }
</script>
{% endblock %}
